<?php/** * Created by PhpStorm. * User: NAGUI * Date: 14/11/2015 * Time: 23:34 */$Suppid = filter_input(INPUT_GET, 'SuppID', FILTER_VALIDATE_INT);$Limite = filter_input(INPUT_GET, 'd', FILTER_VALIDATE_INT);if (!$Limite) {    $Limite = 0;}if (filter_input(INPUT_POST, 'Filter')) {    $SpecFilter = filter_input(INPUT_POST, 'Spec', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $SectFilter = filter_input(INPUT_POST, 'secteur', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $DelFilter = filter_input(INPUT_POST, 'delegation', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $NomFilter = filter_input(INPUT_POST, 'NomPros', FILTER_SANITIZE_STRING);    $ActiviteFilter = filter_input(INPUT_POST, 'ActiviteFilter', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $Potentiel = filter_input(INPUT_POST, 'Potentiel', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $Etab = filter_input(INPUT_POST, 'Etab', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $_SESSION['filter']['validate'] = 1;    $_SESSION['filter']['SectFilter'] = $SectFilter;    $_SESSION['filter']['SpecFilter'] = $SpecFilter;    $_SESSION['filter']['DelFilter'] = $DelFilter;    $_SESSION['filter']['NomFilter'] = $NomFilter;    $_SESSION['filter']['ActiviteFilter'] = $ActiviteFilter;    $_SESSION['filter']['Potentiel'] = $Potentiel;    $_SESSION['filter']['Etab'] = $Etab;     if($_SESSION['user']['type']<3){    $ListeProspect = GetData($NomFilter, $SpecFilter, $SectFilter, $DelFilter, $ActiviteFilter, $Potentiel,$Etab, array($Limite, 30));     }else{         //deleguer :          //récupération des filtre                $FilterListe=get('*','liste',array('user_id='=>$_SESSION['user']['id']));  $FilterInf=$FilterListe['reponse'][0]; if($SectFilter=="" && $FilterInf['secteur']!=""){$SectFilter=explode('@_@',$FilterInf['secteur']); } if($DelFilter=="" && $FilterInf['delegation']!=""){$DelFilter=explode('@_@',$FilterInf['delegation']);  } if($SpecFilter=="" && $FilterInf['spec']!=""){$SpecFilter=explode('@_@',$FilterInf['spec']);  } if($Etab=="" && $FilterInf['etab']!=""){$Etab=explode('@_@',$FilterInf['etab']); }             $ListeProspect = GetData($NomFilter, $SpecFilter, $SectFilter, $DelFilter, $ActiviteFilter, $Potentiel,$Etab, array($Limite, 30));     }} else {    if (filter_var($_SESSION['filter']['validate']) != 0):        $ActiviteFilter = $_SESSION['filter']['ActiviteFilter'];        $NomFilter = $_SESSION['filter']['NomFilter'];        $DelFilter = $_SESSION['filter']['DelFilter'];        $SpecFilter = $_SESSION['filter']['SpecFilter'];        $SectFilter = $_SESSION['filter']['SectFilter'];        $Potentiel = $_SESSION['filter']['Potentiel'];        $Etab = $_SESSION['filter']['Etab'];        $ListeProspect = GetData($NomFilter, $SpecFilter, $SectFilter, $DelFilter, $ActiviteFilter, $Potentiel,$Etab, array($Limite, 30));        else:            if($_SESSION['user']['type']<3){            $ListeProspect = get("*", 'prospect', array('public >' => '0'), "AND", array('id' => 'ASC'), array($Limite, 30));            }else{                //récupération des filtre                $FilterListe=get('*','liste',array('user_id='=>$_SESSION['user']['id']));  $FilterInf=$FilterListe['reponse'][0]; if($FilterInf['secteur']!=""){$SectFilter=explode('@_@',$FilterInf['secteur']); } if($FilterInf['delegation']!=""){$DelFilter=explode('@_@',$FilterInf['delegation']);  } if($FilterInf['spec']!=""){$SpecFilter=explode('@_@',$FilterInf['spec']);  } if($FilterInf['etab']!=""){$Etab=explode('@_@',$FilterInf['etab']); }            $ListeProspect = GetData($NomFilter, $SpecFilter, $SectFilter, $DelFilter, $ActiviteFilter, $Potentiel,$Etab, array($Limite, 30));            }            endif;}//endif;if (filter_input(INPUT_GET, 'reset')) {    unset($_SESSION['filter']);    $_SESSION['filter']=array();    redirect('liste');}$Bread = "liste";$pkr=filter_input(INPUT_GET,'prk',FILTER_SANITIZE_STRING);if ($Suppid != "") {    if($pkr){        update($Suppid, array('public' => 2,'pkr'=>$pkr, 'modifier_par' => $_SESSION['user']['id']), 'prospect');        $_SESSION['msg'] = "Demande de suppression est récu, Motif est $pkr ";        $_SESSION['type'] = "alert-success";        redirect('liste');    }else{        $_SESSION['msg'] = "Demande n'on effectuer pas de demande";        $_SESSION['type'] = "alert-danger";        redirect('liste');    }}?><section class="content-header">    <h1> Gestion des prospects  </h1></section><!-- Main content --><section class="content">    <div class="row">        <div class="col-md-12">            <div class="box box-primary">                <div class="box-header">                     <form class="form-horizontal" method="POST" action="liste">                        <div class="col-md-6">                            <div class="form-group">                             <label>Choix du gouvernera</label>                            <select id="Secteur" name="secteur[]" class="form-control select2"  onchange="FindDel()" multiplE>                              <?php                              $ListeSecteur=get("*",'gouvernerat',array('1='=>1),'AND',array('nom'=>'ASC'));                             foreach($ListeSecteur['reponse'] as $sect):                                if($StdFunctions->getListe('secteur',$sect['id'])):                             ?>            <option value="<?=$sect['id']?>"><?=$sect['nom']?></option>                                <?endif;endforeach?>                            </select>                        </div>                                                     </div>                        <div class="col-md-6">                            <div class="form-group">                                 <label>Choix des Spécialités</label>                            <select id="Spec" name="Spec[]" class="form-control select2" multiple="multiple">                             <?php                            $ListeSpec=get("*",'specialite');                            foreach($ListeSpec['reponse'] as $spec):                                      if($StdFunctions->getListe('spec',$spec['id'])):    ?>                            <option value="<?=$spec['id']?>" ><?=$spec['nom']?></option>                            <?endif;endforeach?>                            </select>                        </div>                                                    </div>                        <div class="col-md-12" id="DelListe">                                                                                                                                </div>                            <div class="col-md-4">                           <div class="form-group">                              <label>Choix d'activités</label>                             <select class="form-control select2" name="ActiviteFilter[]" multiple> <?php                            $ListeA=get("*",'activite');                            foreach($ListeA['reponse'] as $act):         ?>                            <option value="<?=$act['id']?>" ><?=$act['nom']?></option>                            <?endforeach?>                                                        </select>                        </div>                        </div>                                                                       <div class="col-md-4">                               <label>Potentiel</label>                             <select class="form-control select2" name="Potentiel[]" multiple> <?php                            $ListeP=get("*",'potentiel');                            foreach($ListeP['reponse'] as $potentiel):         ?>                            <option value="<?=$potentiel['id']?>" ><?=$potentiel['valeur']?></option>                            <?endforeach?>                                                        </select>                        </div>                        <div class="col-md-4">                            <div class="form-group">                                  <label>Recherche par Nom</label>                            <input type="text" name="NomPros" value="<?=$NomFilter?>" placeholder="Par nom : Au moins les 3 première lettres" class="form-control">                         </div>                        </div>                        <div class="col-md-4">                         <br/>   <button type="submit" name="Filter" value="1" class="btn btn-block btn-warning">Filtrer</button>                                                </div>                        <div class="col-md-12">                            <? if(isset($_SESSION['filter']['validate'])): ?>                            <h4>Filter existant : </h4>                            <?                             $StdFunctions->filterShow("Filter par secteur : ",$_SESSION['filter']['SectFilter'],'gouvernerat','nom');                             $StdFunctions->filterShow("Filter par délégation : ",$_SESSION['filter']['DelFilter'],'delegation','nom');                             $StdFunctions->filterShow("Filter par specialite : ",$_SESSION['filter']['SpecFilter'],'specialite','nom');                             $StdFunctions->filterShow("Filter par activité : ",$_SESSION['filter']['ActiviteFilter'],'activite','nom');                             $StdFunctions->filterShow("Filter par Potentiel : ",$_SESSION['filter']['Potentiel'],'potentiel','valeur');                             $StdFunctions->filterShow("Filter par Etablissement : ",$_SESSION['filter']['Etab'],'etablissement','nom');                             if($_SESSION['filter']['NomFilter']!=""){                             echo "<div class=\"pull-left\" style=\"margin-right: 5px;min-width: 20%;\"><h5>Filter par Nom : </h5>".$_SESSION['filter']['NomFilter']."</div>";                             }                            ?>                            <?if($_SESSION['user']['type']==1 || $_SESSION['user']['type']==2 || $_SESSION['user']['type']==5):?>                            <a href="ToExcel" class="btn btn-adn">Extraction</a>                            <?endif;?>                             <a href="liste?reset=1" class="btn btn-danger pull-right">Annuler</a>                            <?endif;?>                                                       <div class="clearfix"></div>                        </div>                </form>                </div>                <div class="box-body">                    <div class="row">                        <div class="col-md-12 table-responsive">                            <table class="table table-bordered table-condensed" id="ProspTable">                                <thead>                                <tr>                                    <th></th>                                    <th>Prospect</th>                                    <th  class="hidden-xs hidden-sm">Spécialité</th>                                    <th class="hidden-xs hidden-sm">Potentiel</td>                                     <th class="hidden-xs hidden-sm">Activité</td>                                     <th>Action</th>                                </tr>                                </thead>                                <tbody><form method="post" name="ProgForm" action="MyProgramme">                                <? foreach ($ListeProspect['reponse'] as $item):                                                                                                            ?>                                    <tr><td>    <input type="checkbox" name="Prog[]" value="<?=$item['id']?>" onchange="ShowBtn()"></td>                                        <td>                                            <a href="profile?id=<?=$item['id']?>" class="btn btn-facebook btn-block">                                                <i class="fa fa-user-md"></i>                                                <?=$item['nom'].' '.$item['prenom'] ?>                                                <span class="badge">                                         <?=getVisiteNbr($item['id']) ?>                                                     <i class="fa fa-briefcase"></i> </span>                                            </a>                                            <span class="hidden-md hidden-lg"><?=getinfo($item['spec'],'specialite','nom'); ?></span>                                        </td>                                        <td class="hidden-xs hidden-sm"><?=getinfo($item['spec'],'specialite','nom'); ?></td>                                        <td class="hidden-xs hidden-sm"><?=getinfo($item['potentiel'],'potentiel','valeur'); ?> </td>                                         <td class="hidden-xs hidden-sm"><?=getinfo($item['activite'],'activite','nom'); ?></td>                                         <td>                      <a  data-id="<?=$item['id']?>" data-title="Suppresion d'un prospect" href="#" class="btn btn-danger confirm-delete" data-toggle="tooltip" title="Supprimer" alt="Supprimer"><i class="fa fa-trash"></i></a>                      <a href="modifier?id=<?=$item['id']?>"  class="btn btn-success" data-toggle="tooltip" title="Modifier"><i class="fa fa-edit"></i></a>                      <a href="visite?id=<?=$item['id']?>" class="btn btn-primary" data-toggle="tooltip" title="Visite"><i class="fa fa-briefcase"></i></a>                      <? if($_SESSION['user']['type']){?>                      <a href="ciblage?id=<?=$item['id']?>" class="btn btn-adn" data-toggle="tooltip" title="Ciblage"><i class="fa fa-crosshairs"></i></a>                      <?}?>                                            <a href="MyProgramme?id=<?=$item['id']?>" class="btn btn-bitbucket" data-toggle="tooltip" title="Programmer">                                                <i class="fa fa-clock-o"></i>                                            </a>                                        </td>                                    </tr>                                <?endforeach?>                        <tr>                            <td>                                <button type="submit" name="AddProg" value="1" class="btn btn-bitbucket">                                    <i class="fa fa-clock-o"></i>                                </button>                            </td>                            <td colspan="5"></td>    </tr>                                </tbody></form>                            </table>                        </div>                    </div>                    <div class="row">                        <div class="col-md-5">                            <div class="dataTables_info" id="example2_info" role="status" aria-live="polite">                                Affichage de <?=($Limite>1) ? $Limite : 1?> à <?=($Limite+30<$ListeProspect['total']) ? $Limite+30 : $ListeProspect['total']?> de <?=$ListeProspect['total']?> prospects                            </div>                        </div>                        <div class="col-md-7">                            <div class="dataTables_paginate paging_simple_numbers" id="example2_paginate">                                <?pagination($ListeProspect['total'],30,WEBRoot."/prospects/liste?d=",""); ?>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div>    </section>