<?php/** * Created by PhpStorm. * User: NAGUI * Date: 10/11/2015 * Time: 14:41 */$Bread="Liste-demandes";$Suppid=  filter_input(INPUT_GET,'SuppID',FILTER_VALIDATE_INT);if($Suppid!=""){    update($Suppid,array('public'=>0,'modifier_par'=>$_SESSION['user']['id']),'demande');    header('Location:Liste-demandes');}$idValid=  filter_input(INPUT_GET,'idValid',FILTER_VALIDATE_INT);if($idValid!=""){    update($idValid,array('validation'=>1,'modifier_par'=>$_SESSION['user']['id']),'demande');    header('Location:Liste-demandes');}$idBan=  filter_input(INPUT_GET,'idBan',FILTER_VALIDATE_INT);if($idBan!=""){    update($idBan,array('validation'=>-1,'modifier_par'=>$_SESSION['user']['id']),'demande');    header('Location:Liste-demandes');}$BInv=  filter_input(INPUT_POST,'BInv');if($BInv){    $idBinv=  filter_input(INPUT_POST,'id',FILTER_VALIDATE_INT);    update($idBinv,array('budget_investi'=>  filter_input(INPUT_POST,'BudgetInvesti')),'demande');}$where=array('public='=>1);if(filter_input(INPUT_POST,'Filterdate')){    $de=filter_input(INPUT_POST,'de');    $a=filter_input(INPUT_POST,'a');    $where['date >= ' ]=$de;    $where['date <= ' ]=$a;    $usr=filter_input(INPUT_POST,'user');    if($usr)$where['id_user=']=$usr;}$ListeDemandes = get('*', 'demande',$where);//$ListeDemandes = get('*', 'demande',array('public='=>1,));?><section class="content-header">    <h1 class="pull-left"> Liste des demandes     </h1>    <a href="demande" class="btn bg-maroon pull-right">Ajouter une demande</a>    <div class="clearfix"></div></section><!-- Main content --><section class="content">    <div class="row">        <div class="col-md-12">            <div class="box box-primary table-responsive">                <div class="pull-right" style="margin: 10px;">                    <form class="form-inline" method="post">                        <? if($_SESSION['user']['type']<3 || $_SESSION['user']['type']==5): ?>                        <div class="form-group">                            <select class="form-control" name="user">                                <option value="">Par utilisateur</option>                                <?                                $ListeUser=get('*','users',array('type>'=>2));                                foreach($ListeUser['reponse'] as $user):                                    ?>                                    <option value="<?=$user['id']?>" <?if($user['id']==$usr){                                        echo "selected=selected";                                    }?>><?=$user['Nom'].' '.$user['Prenom'] ?></option>                                <?endforeach;?>                            </select>                        </div>                        <?endif?>                        <div class="form-group">                            <label>De </label>                            <input type="date" name="de" class="form-control" value="<?=$de?>" required>                        </div>                        <div class="form-group">                            <label>A </label>                            <input type="date" name="a" class="form-control" value="<?=$a?>" required></div>                        <button type="submit" name="Filterdate" value="1" class="btn btn-primary">Filter</button>                        <a href="" class="btn btn-warning">Annuler</a>                    </form>                </div><div class="clearfix"></div>                <table class="table table-bordered table-condensed table-hover">                    <thead>                        <tr>                            <th>#</th>                            <th>Délégué</th>                            <th>Type</th>                            <th>Date</th>                            <th>Action</th>                        </tr>                    </thead>                    <tbody><? foreach ($ListeDemandes['reponse'] as $demande):  if($_SESSION['user']['id']==$demande['id_user'] || $StdFunctions->getDemande($demande['id_user'])===true):      ?>                        <tr class="<?if($demande['validation']>0){echo 'bg-green';} if($demande['validation']<0){echo 'bg-yellow-active';}?> ">                                <td><?= $demande['id'].'/'.date("Y", strtotime($demande['date'])) ?></td>                                <td><?= getinfo($demande['id_user'] ,'users','Nom').' '.getinfo($demande['id_user'] ,'users','Prenom')?></td>                                <td><?= getinfo($demande['type'],'type_demande', 'name') ?></td>                                <td><?= $demande['date'] ?></td>                                <td>                                    <? if($_SESSION['user']['type']<3 || $_SESSION['user']['type']==5): ?>                                    <a data-id="<?=$demande['id']?>" data-title="Suppresion d'une demande" href="#" class="btn btn-danger confirm-delete">                                        <span class="glyphicon glyphicon-trash"></span>                                    </a>                                        <a href="?idValid=<?= $demande['id'] ?>" class="btn btn-success">                                            <span class="glyphicon glyphicon-check"></span>                                        </a>                                        <a href="?idBan=<?= $demande['id'] ?>" class="btn btn-warning">                                            <span class="glyphicon glyphicon-ban-circle"></span>                                        </a>                                    <?endif;?>                                    <?if($demande['validation']<=0 && $_SESSION['user']['type']>2){?>                                    <? // test if validatied or 1 comm is add  if(CounTable('commentaire','demande_id', "=", $demande['id'])<=1):                                    ?>                                    <a href="edit?id=<?=$demande['id']?>" class="btn btn-primary">                                        <span class="glyphicon glyphicon-pencil"></span>                                    </a>                                    <?  endif;?>                                                                       <?}else if($_SESSION['user']['type']==5){?>                                    <form class="form-inline" method="post">                                        <input type="hidden" name="id" value="<?=$demande['id'] ?>">                                        <div class="form-group">                                             <input type=number step=0.001 min="0" name="BudgetInvesti" value="<?=$demande['budget_investi'] ?>" placeholder="B.Investi" class="form-control" required>                </div>                                        <button type="submit" value="1" class="btn btn-primary" name="BInv">Ajouter</button>                                    </form>                                    <?}?>                                     <a href="detail?id=<?= $demande['id'] ?>" class="btn btn-pinterest">                                        <span class="glyphicon glyphicon-paperclip"></span>                                    </a>                                </td>                            </tr><?endif; endforeach; ?>                    </tbody>                </table>            </div>        </div>    </div></section>