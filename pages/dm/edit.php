<?php// ajout d'une demande $id = filter_input(INPUT_GET, 'id', FILTER_VALIDATE_INT);//get 1er commentaire$CommInfo=get("*",'commentaire',array('demande_id = '=>$id)); $IdComm=$CommInfo['reponse'][0]['id'];if (filter_input(INPUT_POST, 'Adddemande', FILTER_VALIDATE_INT)):    $Allpros = filter_input(INPUT_POST, 'AllPros', FILTER_DEFAULT);    $secteur = filter_input(INPUT_POST, 'secteur', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $delegation = filter_input(INPUT_POST, 'delegation', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $Spec = filter_input(INPUT_POST, 'Spec', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $date = filter_input(INPUT_POST, 'date', FILTER_DEFAULT);    $Lieu = filter_input(INPUT_POST, 'Lieu', FILTER_DEFAULT);    $BudgetDemander = filter_input(INPUT_POST, 'BudgetDemander', FILTER_DEFAULT);    $BudgetInvesti = filter_input(INPUT_POST, 'BudgetInvesti', FILTER_DEFAULT);    $type_manif = filter_input(INPUT_POST, 'type_manif', FILTER_DEFAULT);    $objectif = filter_input(INPUT_POST, 'objectif', FILTER_DEFAULT);    $commentaire = filter_input(INPUT_POST, 'commentaire', FILTER_DEFAULT);    $prospects = filter_input(INPUT_POST, 'ProListe', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $produits = filter_input(INPUT_POST, 'produits', FILTER_DEFAULT, FILTER_REQUIRE_ARRAY);    $ProsToAdd = "";    if ($Allpros == NULL) {        foreach ($prospects as $key => $value) {            $ProsToAdd = $ProsToAdd . '_@_' . $value;        }        $Allpros = count($prospects);    }//explode('_@_',substr($ProsToAdd,3) )     $datas = array(         'id_user' => $_SESSION['user']['id'],        'all_pros' => $Allpros,        'prospects' => $ProsToAdd,        'secteur' =>$secteur ? implode("@_@", $secteur) : "",        'delegation' => $delegation ? implode("@_@", $delegation) : "",        'Spec' => $Spec ? implode("@_@", $Spec) : "",        'type' => $type_manif,        'date' => $date,        'lieu' => $Lieu,        'budget_demander' => $BudgetDemander,        'budget_investi' => $BudgetInvesti,        'objectif' => $objectif,        'prod' => $produits ? implode("_@_", $produits) : "",        'commentaire' => $commentaire,        'cree_par' => $_SESSION['user']['id'],        'modifier_par' => '',        'created_at' => date("Y-m-d H:i:s"),        'validation' => 0,        'public' => 1    );    $demande_id = update($id,$datas, 'demande');    if ($demande_id) {// ajouter 1er commentaire  :         $com = array(            'cree_par' => $_SESSION['user']['id'],            'com' => $commentaire,            'created_at' => date("Y-m-d H:i:s")        );        $comUp=(update($IdComm,$com, 'commentaire'));       if ($comUp) {            $_SESSION['msg'] = "Demande modifier avec success";            $_SESSION['type'] = "alert-success";             redirect('Liste-demandes');        }    } else {        $_SESSION['msg'] = "Une Erreur c'est produite";        $_SESSION['type'] = "alert-danger";         redirect('Liste-demandes');    }endif;$FilterListe = get('*', 'demande', array('id=' => $id));$FilterInf = $FilterListe['reponse'][0];$SectFilter = explode('@_@', $FilterInf['secteur']);$DelFilter = explode('@_@', $FilterInf['delegation']);$SpecFilter = explode('@_@', $FilterInf['spec']);$ProFilter = explode('_@_', $FilterInf['prod']);?><section class="content-header">    <h1> Ajouter une demande</h1></section><!-- Main content --><section class="content">    <div class="row">        <form class="" method="post" action=""><input type="hidden" name="id" value="<?=$id?>">            <div class="col-md-4">                <div class="box box-primary">                    <div class="box-body">                        <div class="box-title"><h3>Filtre des prospect invoquer</h3></div>                        <div class="form-group">                            <label for="Secteur">Secteur</label>                            <select id="Secteur" name="secteur[]" class="form-control select2"                                    onchange="FindDelDemande()" multiple>                                <?php                                $ListeSecteur = get("*", 'gouvernerat');                                foreach ($ListeSecteur['reponse'] as $sect):                                    if($StdFunctions->getListe('secteur',$sect['id'])):                                    ?>                                    <option value="<?= $sect['id'] ?>">                                        <?= $sect['nom'] ?></option>                                <?endif; endforeach ?>                            </select>                        </div>                        <div class="form-group">                            <div id="DelListe"></div>                        </div>                        <div class="form-group">                            <label for="Spec">Spécialité</label>                            <select id="Spec" name="Spec[]" class="form-control select2" multiple>                                <?php                                $ListeSpec = get("*", 'specialite');                                foreach ($ListeSpec['reponse'] as $spec):  if($StdFunctions->getListe('spec',$spec['id'])):?>                                    <option value="<?= $spec['id'] ?>" <? if (in_array($spec['id'], $SpecFilter)) {                                        echo 'selected="selected"';                                    } ?>><?= $spec['nom'] ?></option>                                <?endif; endforeach ?>                            </select>                        </div>                        <button type="button" value="1" name="AddListe" class="btn btn-warning btn-block"                                id="FilterPros">Choix des prospects invoquer                        </button>                        <p class="help-block bg-danger" id="MsgPRo">                        </p>                        <div id="DivRes">                            <div class="form-group">                                <label for="Spec">Liste des prospects</label>                                <div id="ListeDiv" class="checkbox"></div>                            </div>                        </div>                    </div>                </div>            </div>            <div class="col-md-4">                <div class="box box-success">                    <div class="box-body">                        <div class="form-group">                            <label>Date</label>                            <input type="date" name="date" value="<?=$FilterInf['date']?>" class="form-control" required>                        </div>                        <div class="form-group">                            <label>Lieu</label>                            <input type="text" name="Lieu" value="<?=$FilterInf['lieu']?>" class="form-control">                        </div>                        <div class="form-group">                            <label>Choix des produits</label>                            <select class="form-control select2" multiple name="produits[]">                                <?                                $Prod = get("*", 'products');                                foreach ($Prod['reponse'] as $produit):                                    ?>                                    <option value="<?= $produit['id'] ?>" <? if(in_array($produit['id'],$ProFilter)) {                                        echo 'selected="selected"';                                    } ?>><?= $produit['name'] ?></option>                                <? endforeach; ?>                            </select>                        </div>                    </div>                </div>            </div>            <div class="col-md-4">                <div class="box box-success">                    <div class="box-body">                        <div class="form-group">                            <label>Budget demandé</label>                            <input type=number step=0.001 min="0" name="BudgetDemander" value="<?=$FilterInf['budget_demander']?>" class="form-control"                                   required>                        </div>                        <div class="form-group">                            <label>Type</label>                            <select class="form-control" name="type_manif" required>                                <?                                $ListeManif = get("*", 'type_demande');                                foreach ($ListeManif['reponse'] as $manif):                                    ?>                                    <option value="<?= $manif['id'] ?>" <?                                    if($FilterInf['type']==$manif['id']) { echo 'selected="selected"';}                                    ?>><?= $manif['name'] ?></option>                                <? endforeach; ?>                            </select>                        </div>                        <div class="form-group">                            <label>Objectif</label>                            <input type="text" name="objectif" value="<?=$FilterInf['objectif']?>" class="form-control" required>                        </div>                    </div>                </div>            </div>            <div class="col-md-12">                <div class="box box-danger">                    <div class="box-body">                        <div class="box-title"><h3>Les informations de la demande</h3></div>                        <label>Commentaire</label>                        <!-- 1er commentaire -->                        <textarea class="textarea" placeholder="" name="commentaire" required style="width: 100%; height: 200px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;"><?=$FilterInf['commentaire']?></textarea>                        <button type="submit" name="Adddemande" value="1" class="btn btn-primary pull-right">Modifier                            votre demande                        </button>                        <div class="clearfix"></div>                    </div>                </div>            </div>        </form>    </div></section>